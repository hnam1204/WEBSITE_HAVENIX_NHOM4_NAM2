@model HV_NIX.Models.Products

@{
    ViewBag.Title = "Chi tiết sản phẩm";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="product-container">
    <div class="product-content">

        <!-- ====================== IMAGE GALLERY ====================== -->
        <div class="image-gallery">

            <!-- Thumbnail bên trái -->
            <div class="thumbnail-list">
                @if (!string.IsNullOrEmpty(Model.Thumbnail))
                {
                    <img src="@Url.Content("~/Content/Images/" + Model.Thumbnail)"
                         class="thumb-item active-thumb"
                         onclick="changeMainImage(this)" />
                }

                @if (!string.IsNullOrEmpty(Model.Image1))
                {
                    <img src="@Url.Content("~/Content/Images/" + Model.Image1)"
                         class="thumb-item"
                         onclick="changeMainImage(this)" />
                }

                @if (!string.IsNullOrEmpty(Model.Image2))
                {
                    <img src="@Url.Content("~/Content/Images/" + Model.Image2)"
                         class="thumb-item"
                         onclick="changeMainImage(this)" />
                }
            </div>

            <!-- Ảnh lớn -->
            <div class="main-image-box">
                <img id="mainImage"
                     src="@Url.Content("~/Content/Images/" + Model.Thumbnail)"
                     class="main-image" />
            </div>

        </div>
        <!-- ====================== END IMAGE GALLERY ====================== -->
        <!-- ====================== THÔNG TIN SẢN PHẨM ====================== -->
        <div class="product-info-section sticky-info">
            <h1 class="product-name">@Model.ProductName</h1>
            <div class="product-price">@Model.Price.ToString("N0")₫</div>

            <!-- Size -->
            <div class="product-option">
                <label class="option-label">Kích thước</label>
                <div class="size-buttons">
                    <button class="size-btn active" data-size="M">M</button>
                    <button class="size-btn" data-size="L">L</button>
                    <button class="size-btn" data-size="XL">XL</button>
                </div>
            </div>

            <!-- Add to Cart -->
            <button class="btn-add-cart" data-id="@Model.ProductID">
                Thêm vào giỏ hàng
            </button>


            <!-- Mô tả -->
            <div class="product-description">
                <h3>Mô tả sản phẩm</h3>

                <div class="description-text">
                    @if (!string.IsNullOrEmpty(Model.Description))
                    {
                        <p>@Html.Raw(Model.Description.Replace("\n", "<br />"))</p>
                    }
                    else
                    {
                        <p class="text-muted">Không có mô tả cho sản phẩm này.</p>
                    }
                </div>
            </div>
        </div>

    </div>
</div>


<!-- =======================================================
     🔥 SẢN PHẨM LIÊN QUAN
======================================================= -->
@if (ViewBag.RelatedProducts != null)
{


    <h2 class="title">SẢN PHẨM LIÊN QUAN</h2>

    <div class="product-grid">
        @foreach (var item in ViewBag.RelatedProducts as List<HV_NIX.Models.Products>)
        {
            <div class="card" onclick="location.href='@Url.Action("Details", "Product", new { id = item.ProductID })'">
                <div class="thumb" style="background-image:url('@Url.Content("~/Content/Images/" + item.Thumbnail)')"></div>

                <div class="card-body">
                    <h3 class="title">@item.ProductName</h3>
                    <p class="price">@string.Format("{0:N0}₫", item.Price)</p>
                </div>
            </div>
        }
    </div>
}


@section Scripts {

    <!-- ========== JS đổi ảnh nền ========== -->
    <script>
        function changeMainImage(element) {
            document.getElementById("mainImage").src = element.src;

            document.querySelectorAll(".thumb-item")
                .forEach(e => e.classList.remove("active-thumb"));

            element.classList.add("active-thumb");
        }
    </script>


    <!-- ========== JS ADD TO CART ========== -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            let selectedSize = "M";

            // Chọn size
            document.querySelectorAll(".size-btn").forEach(btn => {
                btn.addEventListener("click", function () {
                    document.querySelectorAll(".size-btn").forEach(b => b.classList.remove("active"));
                    this.classList.add("active");
                    selectedSize = this.dataset.size;
                });
            });

            // Add to cart
            const addBtn = document.querySelector(".btn-add-cart");

            addBtn.addEventListener("click", function () {

                let productId = this.dataset.id;

                fetch('/Cart/Add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: `productId=${productId}&size=${selectedSize}&quantity=1`
                })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            alert(`Đã thêm size ${selectedSize} vào giỏ hàng!`);
                        } else {
                            alert("Không thể thêm vào giỏ hàng!");
                        }
                    })
                    .catch(err => console.error("Lỗi thêm vào giỏ hàng:", err));
            });

        });

    </script>
}

<style>

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background: #fafbfc;
    }

    .product-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1.5rem;
    }

    .product-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 3rem;
        background: white;
        border-radius: 6px;
        padding: 2rem;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        border: 1px solid #f3f4f6;
    }

    /* ====================== THUMBNAIL + MAIN IMAGE ====================== */

    .image-gallery {
        display: flex;
        gap: 20px;
    }

    .thumbnail-list {
        width: 110px;
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .thumb-item {
        width: 100%;
        height: 100px;
        object-fit: cover;
        border-radius: 6px;
        border: 2px solid transparent;
        cursor: pointer;
        transition: 0.25s;
    }

        .thumb-item:hover {
            border-color: #ff4444;
        }

    .active-thumb {
        border-color: #ff4444;
    }

    .main-image-box {
        flex: 1;
    }

    .main-image {
        width: 100%;
        border-radius: 10px;
        border: 1px solid #e5e7eb;
        object-fit: contain;
    }

    /* ====================== INFO ====================== */

    .product-info-section {
        display: flex;
        flex-direction: column;
    }

    .product-name {
        font-size: 1.75rem;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 1rem;
        line-height: 1.3;
    }

    .product-price {
        font-size: 1.5rem;
        font-weight: 700;
        color: red;
        margin-bottom: 2rem;
    }


    .option-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
    }

    .size-buttons {
        display: flex;
        gap: 0.75rem;
        margin-bottom: 20px;
    }

    .size-btn {
        padding: 10px 20px;
        border: 1px solid #ccc;
        background: white;
        border-radius: 5px;
        cursor: pointer;
        transition: 0.2s;
    }

        .size-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

    .btn-add-cart {
        width: 100%;
        padding: 12px;
        background: #000000;
        color: white;
        border-radius: 4px;
        border: none;
        margin-bottom: 2rem;
    }

    .product-description {
        border-top: 1px solid #ddd;
        padding-top: 20px;
    }

    .sticky-info {
        position: sticky;
        top: 100px;
        align-self: flex-start;
        height: fit-content;
    }
    /* ================================
        SẢN PHẨM LIÊN QUAN
    ================================ */

    .title {
        text-align: center;
        font-size: 26px;
        margin: 60px 0 30px;
        font-weight: 700;
    }

    .product-grid {
        max-width: 1200px;
        margin: 0 auto; 
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); 
        gap: 30px;
        justify-items: center;
    }

        .product-grid .card {
            width: 100%;
            max-width: 280px;
            border-radius: 18px;
            overflow: hidden;
            cursor: pointer;
            transition: 0.25s;
            background: #fff;
            border: 1px solid #eee;
        }

            .product-grid .card:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 22px rgba(0,0,0,0.12);
            }

        .product-grid .thumb {
            width: 100%;
            padding-top: 110%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .product-grid .card-body {
            padding: 15px;
            text-align: center;
        }

            .product-grid .card-body .title {
                font-size: 15px !important;
                font-weight: 700;
                color: #333;
                margin-bottom: 6px;
                min-height: 42px;
            }

        .product-grid .price {
            font-size: 16px;
            font-weight: 700;
            color: red;
        }

</style>
